<html>
  <head>
    <title>Mix2D</title>
    <script src="mix2d.js" type="text/javascript"></script>
  </head>
  <body onload="update()">
    <form>
      <input type="text" id="funfunfun" value="x/50 + y/50" onkeyup="tryupdate()" />
      <input type="button" onclick="update()" value="Update" />
    </form>
    <canvas id="yeswecanvas" height=512 width=512 />
    <script type="text/javascript">
      function makeColorCanvasData(color) {
        var canvas = document.createElement('canvas');
        canvas.height = 512;
        canvas.width  = 512;
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, canvas.height, canvas.width);
        var data = ctx.getImageData(0, 0, canvas.width, canvas.height);
        return data;
      }

      var sources = [ makeColorCanvasData("#666")
                    , makeColorCanvasData("#999")
                    , makeColorCanvasData("#bbb")
                    ];

      function update(){
        var v = document.getElementById("funfunfun").value;
        var text = "var x=this.x;var y=this.y;return (" + v + ")";
        var f = new Function(text);
        mix2d_draw("yeswecanvas", sources, function(x, y) {
            var t = {"x": x, "y": y};
            return f.apply(t);
            });
        lastupdate = new Date();
      };
      function tryupdate(){
        try {
          window.setTimeout(update, 50);
        } catch (e) {
          if (!(e instanceof SyntaxError)) {
            throw (e);
          }
        }
      }
    </script>
  </body>
</html>
